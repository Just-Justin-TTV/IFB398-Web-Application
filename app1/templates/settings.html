{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>User Settings - CarbonBalance</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { brand: { DEFAULT:"#0ea5e9", 600:"#0891b2", 700:"#0e7490" } },
          borderRadius: { "2xl": "1rem" }
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body class="min-h-screen bg-gray-50 text-gray-900">

<div class="flex min-h-screen">

  <!-- Sidebar -->
  <aside class="w-64 shrink-0 bg-white border-r shadow-sm">
    <div class="px-5 py-6 border-b">
      <div class="flex items-center gap-3">
        <img src="{% static 'images/img4.jpg' %}" alt="Logo" class="w-10 h-10 rounded-full object-cover">
        <div>
          <p class="text-xs text-gray-500">Welcome</p>
          <p class="text-sm font-semibold">{{ request.session.user_name|default:"" }}</p>
        </div>
      </div>
    </div>
    <nav class="px-3 py-4 space-y-1">
      <a href="{% url 'dashboard' %}" class="flex items-center gap-3 px-3 py-2 rounded-lg {% if 'dashboard' in request.path %}bg-brand text-white shadow{% else %}text-gray-700 hover:bg-gray-100{% endif %}">
        <span class="material-icons text-[18px]">dashboard</span> Dashboard
      </a>
      <a href="{% url 'projects' %}" class="flex items-center gap-3 px-3 py-2 rounded-lg {% if 'projects' in request.path %}bg-brand text-white shadow{% else %}text-gray-700 hover:bg-gray-100{% endif %}">
        <span class="material-icons text-[18px]">folder</span> Projects
      </a>
      <a href="{% url 'reports' %}" class="flex items-center gap-3 px-3 py-2 rounded-lg text-gray-700 hover:bg-gray-100">
        <span class="material-icons text-[18px]">description</span> Reports
      </a>
      <a href="{% url 'settings' %}" class="flex items-center gap-3 px-3 py-2 rounded-lg bg-brand text-white shadow">
        <span class="material-icons text-[18px]">settings</span> Settings
      </a>
    </nav>
  </aside>

  <!-- Main content -->
  <main class="flex-1">
    <header class="bg-white border-b">
      <div class="max-w-7xl mx-auto px-6 py-5 flex items-center justify-between">
        <div>
          <h1 class="text-2xl font-semibold">User Settings</h1>
          <p class="text-sm text-gray-600">Manage your account preferences and security settings</p>
        </div>
      </div>
    </header>

    <div class="max-w-4xl mx-auto px-6 py-10">
      <!-- Django messages -->
      {% if messages %}
      <div class="mb-8 space-y-4">
        {% for message in messages %}
        <div class="{% if message.tags == 'success' %}bg-green-50 border border-green-200 text-green-800{% else %}bg-red-50 border border-red-200 text-red-800{% endif %} px-5 py-4 rounded-lg">
          <span class="text-sm font-medium">{{ message }}</span>
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <!-- Account Settings Sections -->
      <div class="space-y-16">

        <!-- Display Preferences -->
        <div class="bg-gray-50 rounded-xl p-8 border border-gray-200">
          <h2 class="text-2xl font-semibold mb-8">Display Preferences</h2>
          <div class="space-y-8">
            <div>
              <label class="block font-medium mb-4 text-lg">Color Theme</label>
              <select id="themeSelector" class="w-full px-5 py-4 border rounded-xl bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 transition-colors duration-200">
                <option value="light" {% if request.session.theme == 'light' %}selected{% endif %}>Light Theme</option>
                <option value="high-contrast" {% if request.session.theme == 'high-contrast' %}selected{% endif %}>High Contrast Theme</option>
              </select>
            </div>
            <div>
              <label class="block font-medium mb-4 text-lg">Text Display Size</label>
              <select id="textSizeSelector" class="w-full px-5 py-4 border rounded-xl bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 transition-colors duration-200">
                <option value="small" {% if request.session.text_size == 'small' %}selected{% endif %}>Small Text</option>
                <option value="medium" {% if not request.session.text_size or request.session.text_size == 'medium' %}selected{% endif %}>Medium Text</option>
                <option value="large" {% if request.session.text_size == 'large' %}selected{% endif %}>Large Text</option>
                <option value="xlarge" {% if request.session.text_size == 'xlarge' %}selected{% endif %}>Extra Large Text</option>
              </select>
              <p class="text-gray-500 text-sm mt-3">Adjusts the text size across the application</p>
            </div>
          </div>
        </div>

        <!-- Account Information -->
        <div class="bg-gray-50 rounded-xl p-8 border border-gray-200">
          <h2 class="text-2xl font-semibold mb-8">Account Information</h2>
          <form method="POST" class="space-y-8">
            {% csrf_token %}
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
              <div>
                <label class="block font-medium mb-4 text-lg">Username</label>
                <input type="text" name="username" value="{{ user.username }}" class="w-full px-5 py-4 border rounded-xl bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 transition-colors duration-200">
              </div>
              <div>
                <label class="block font-medium mb-4 text-lg">Email Address</label>
                <input type="email" name="email" value="{{ user.email }}" class="w-full px-5 py-4 border rounded-xl bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 transition-colors duration-200">
              </div>
            </div>
            <button type="submit" name="update_profile" class="bg-gray-700 text-white py-4 px-10 rounded-xl hover:bg-gray-800 transition-all duration-200">Update Profile Information</button>
          </form>
        </div>

        <!-- Password Management -->
        <div class="bg-gray-50 rounded-xl p-8 border border-gray-200">
          <h2 class="text-2xl font-semibold mb-8">Password Management</h2>
          <form method="POST" class="space-y-8">
            {% csrf_token %}
            <div>
              <label class="block font-medium mb-4 text-lg">Current Password</label>
              <input type="password" name="current_password" placeholder="Enter your current password" class="w-full px-5 py-4 border rounded-xl bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 transition-colors duration-200">
            </div>
            <div>
              <label class="block font-medium mb-4 text-lg">New Password</label>
              <input type="password" name="new_password" placeholder="Enter your new password" class="w-full px-5 py-4 border rounded-xl bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 transition-colors duration-200">
            </div>
            <div>
              <label class="block font-medium mb-4 text-lg">Confirm New Password</label>
              <input type="password" name="confirm_password" placeholder="Confirm your new password" class="w-full px-5 py-4 border rounded-xl bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 transition-colors duration-200">
            </div>
            <button type="submit" name="change_password" class="bg-gray-700 text-white py-4 px-10 rounded-xl hover:bg-gray-800 transition-all duration-200">Change Password</button>
          </form>
        </div>

      </div>
    </div>
  </main>
</div>

<!-- Theme and text size scripts -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const themeSelect = document.getElementById('themeSelector');
  const textSizeSelect = document.getElementById('textSizeSelector');

  themeSelect.addEventListener('change', function() {
    document.documentElement.classList.remove('dark','high-contrast');
    if (this.value === 'high-contrast') document.documentElement.classList.add('high-contrast');
    saveSettingToServer('theme', this.value);
  });

  textSizeSelect.addEventListener('change', function() {
    document.body.classList.remove('text-small','text-medium','text-large','text-xlarge');
    document.body.classList.add('text-' + this.value);
    saveSettingToServer('text_size', this.value);
  });

  function saveSettingToServer(type, value){
    const data = new FormData();
    data.append(type, value);
    fetch('{% url "settings" %}', { method:'POST', headers:{'X-CSRFToken':'{{ csrf_token }}'}, body: data });
  }

  document.body.classList.add('text-{{ request.session.text_size|default:"medium" }}');
});
</script>

<!-- Optional high contrast & text size CSS -->
<style>
.text-small { font-size:0.875rem; } .text-medium { font-size:1rem; } .text-large { font-size:1.125rem; } .text-xlarge { font-size:1.25rem; }

/* High contrast mode overrides */
.high-contrast { background-color:#000 !important; color:#fff !important; }
.high-contrast .bg-white { background-color:#000 !important; color:#fff !important; border-color:#fff !important; }
.high-contrast .bg-gray-50 { background-color:#000 !important; color:#fff !important; border-color:#fff !important; }
.high-contrast input, .high-contrast select { background-color:#000 !important; color:#fff !important; border-color:#fff !important; }
.high-contrast .text-gray-500, .high-contrast .text-gray-600, .high-contrast .text-gray-700, .high-contrast .text-gray-800, .high-contrast .text-gray-900 { color:#fff !important; }
.high-contrast .dark\:text-gray-300, .high-contrast .dark\:text-gray-400 { color:#fff !important; }
.high-contrast button { background-color:#fff !important; color:#000 !important; }
.high-contrast button:hover { background-color:#ddd !important; }
</style>

</body>
</html>
